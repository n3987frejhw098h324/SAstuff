repeat wait() until game:IsLoaded()

for _,v in next, getconnections(game.Players.LocalPlayer.Idled) do
    v:Disable()
end

nocd = hookfunction(wait, function() return nocd(0) end)

local p = game:GetService("Players")
local lp = p.LocalPlayer
local c = lp.Character or lp.CharacterAdded:Wait()
local hrp = c:WaitForChild("HumanoidRootPart")
local h = c:WaitForChild("Humanoid")
local ok, w = true, workspace
local atk, o, ph, hp = w.Dead, w.ObbyW, w.BossPhase, w.TrollHealth

if w:FindFirstChild("Effects") then w.Effects:Destroy() end
if w.Map:FindFirstChild("ThunderParts") then w.Map.ThunderParts:Destroy() end

local function eq()
    local tool = c:FindFirstChild("KnightsSword")
    if tool and tool:FindFirstChild("Handle") then
        local box = Instance.new("SelectionBox", tool.Handle)
        box.Name, box.Adornee = "sb", tool.Handle
        tool.Handle.Massless = true
        tool.GripPos = Vector3.new(0,0,0)
        h:UnequipTools()
        tool.Parent = c
        tool.Handle.Size = Vector3.new(2, 2, 500)
    end
end

local ks = lp.Backpack:FindFirstChild("KnightsSword") or c:FindFirstChild("KnightsSword")
if ks then ks.Parent = c eq() end

task.spawn(function()
    while not atk.Value do task.wait()
        if o.Value then
            hrp.CFrame = CFrame.new(20.456, 113.245, 196.613)
        elseif ph.Value == "None" then
            hrp.CFrame = CFrame.new(-5.47, -4.45, 248.21)
        else
            hrp.CFrame = CFrame.new(-19.89, -4.77, 142.49)
        end
    end
end)

task.spawn(function()
    while not atk.Value do task.wait()
        if not o.Value and c:FindFirstChild("KnightsSword") then
            c.KnightsSword:Activate()
        end
    end
end)

local function pct(x, y) return x / y end

hp:GetPropertyChangedSignal("Value"):Connect(function()
    local p = pct(hp.Value, hp.MaxHealth.Value)
    if ok and p <= 0.003 and p >= 0 then
        ok = false
        h:UnequipTools()
        wait(WaitTime)
        lp.Backpack["KnightsSword"].Parent = c
    end
end)

game:GetService("RunService").RenderStepped:Connect(function()
    if c and hrp and w:FindFirstChild("TrollPrism") then
        local pos, t = hrp.Position, w.TrollPrism.Position
        local dir = (t - pos).Unit
        hrp.CFrame = CFrame.lookAt(pos, pos + Vector3.new(-dir.Z, 0, dir.X))
    end
end)
