repeat wait() until game:IsLoaded() and game:GetService("Players")

-- anti afk lol
for _,v in pairs(getconnections(game.Players.LocalPlayer.Idled)) do
    v:Disable()
end

nocd = hookfunction(wait, function(s)
    return nocd(0)
end)

local p = game:GetService("Players")
local lp = p.LocalPlayer
local c = lp.Character or lp.CharacterAdded:Wait()
local hrp = c:WaitForChild("HumanoidRootPart")
local h = c:WaitForChild("Humanoid")
local ok = true
local atk = game:GetService("Workspace").Dead
local o = game:GetService("Workspace").ObbyW
local ph = game:GetService("Workspace").BossPhase
local hp = game:GetService("Workspace").TrollHealth
local w = game:GetService("Workspace")

if w:FindFirstChild("Effects") then
    w.Effects:Destroy()
end
if w.Map:FindFirstChild("ThunderParts") then
    w.Map.ThunderParts:Destroy()
end

local function eq()
    local tool = c:FindFirstChild("KnightsSword")
    if tool and tool:FindFirstChild("Handle") then
        local box = Instance.new("SelectionBox")
        box.Name = "sb"
        box.Parent = tool.Handle
        box.Adornee = tool.Handle
        tool.Handle.Massless = true
        tool.GripPos = Vector3.new(0,0,0)
        c:FindFirstChildOfClass("Humanoid"):UnequipTools()
        tool.Parent = c
        tool.Handle.Size = Vector3.new(2, 2, 500)
    end
end

if lp.Backpack:FindFirstChild("KnightsSword") then
    lp.Backpack["KnightsSword"].Parent = c
    eq()
elseif c:FindFirstChild("KnightsSword") then
    eq()
end

task.spawn(function()
    while not atk.Value do task.wait()
        if o.Value then
            hrp.CFrame = CFrame.new(20.456, 113.245, 196.613)
        else
            if ph.Value == "None" then
                hrp.CFrame = CFrame.new(-5.47, -4.45, 248.21)
            else
                hrp.CFrame = CFrame.new(-19.89, -4.77, 142.49)
            end
        end
    end
end)

task.spawn(function()
    while not atk.Value do task.wait()
        if not o.Value then
            if c:FindFirstChild("KnightsSword") then
                c.KnightsSword:Activate()
            end
        end
    end
end)

local function pct(x, y)
    return (x / y)
end

hp:GetPropertyChangedSignal("Value"):Connect(function()
    if pct(hp.Value, hp.MaxHealth.Value) <= 0.003 and pct(hp.Value, hp.MaxHealth.Value) >= 0 then
        if ok then
            ok = false
            c:FindFirstChildOfClass("Humanoid"):UnequipTools()
            wait(0) --idfk what was the original gng tryna do with "WaitTime" but ok
            lp.Backpack["KnightsSword"].Parent = c
        end
    end
end)

-- ts the uhh aiming thing
game:GetService("RunService").RenderStepped:Connect(function()
    if not c or not c:FindFirstChild("HumanoidRootPart") or not workspace:FindFirstChild("TrollPrism") then return end
    local pos = hrp.Position
    local t = workspace.TrollPrism.Position
    local dir = (t - pos).Unit
    local side = Vector3.new(dir.Z, 0, -dir.X)
    hrp.CFrame = CFrame.lookAt(pos, pos + side)
end)
